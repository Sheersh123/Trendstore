pipeline {
  agent any

  environment {
    DOCKERHUB_CREDS = 'Token-02'
    DOCKERHUB_USER  = 'sheershsinha'
    IMAGE_NAME      = 'sheershsinha/trendstore'
    IMAGE_TAG       =  'v1'
    IMAGE           = "${DOCKERHUB_USER}/${IMAGE_NAME}"  // Secret file credential
  }

  stages {
    stage('Checkout') {
      steps {
        checkout scm
      }
    }

   stage('Build & Push Image') {
  steps {
    script {
      def img = docker.build("${IMAGE_NAME}:${IMAGE_TAG}", ".")
      docker.withRegistry('https://index.docker.io/v1/', sheershsinha) {
        img.push()
        img.push('latest')
      }
    }
  }
}

   }

  post {
    always {
      sh 'docker system prune -af || true'
    }
  }
}
